@model KhadiStore.Application.DTOs.SaleDto
@{
    Layout = null;
    var storeName = "खादी भारत स्टोर";
    var storeSubtitle = "Khadi India Store Management";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Invoice - @Model.InvoiceNumber</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @@media print {
            .no-print {
                display: none !important;
            }

            body {
                margin: 0;
            }

            .container {
                max-width: none;
            }
        }

        body {
            font-size: 14px;
            line-height: 1.4;
        }

        .invoice-header {
            border-bottom: 3px solid #ff6600;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            background: linear-gradient(135deg, rgba(255, 153, 51, 0.1) 0%, rgba(19, 136, 8, 0.1) 100%);
        }

        .brand {
            color: #000080;
            font-weight: 700;
            font-size: 2rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .brand-subtitle {
            color: #ff6600;
            font-size: 1rem;
            font-weight: 500;
        }

        .invoice-details {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }

        .table th, .table td {
            padding: 0.75rem;
            border-color: #dee2e6;
        }

        .table th {
            background: linear-gradient(135deg, #ff6600 0%, #ff9933 100%);
            color: white;
            font-weight: 600;
        }

        .footer {
            border-top: 2px solid #ff6600;
            margin-top: 2rem;
            padding-top: 1rem;
            text-align: center;
            color: #666;
        }

        .total-section {
            background: #f8f9fa;
            border: 2px solid #ff6600;
            border-radius: 8px;
        }

        .watermark {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 6rem;
            color: rgba(255, 102, 0, 0.05);
            z-index: -1;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="watermark">खादी भारत</div>

    <div class="container my-4">
        <!-- Print Button -->
        <div class="no-print mb-3 text-center">
            <button onclick="window.print()" class="btn btn-primary btn-lg me-2">
                <i class="fas fa-print me-1"></i> Print Invoice
            </button>
            <a href="@Url.Action("Details", new { id = Model.Id })" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i> Back to Details
            </a>
        </div>

        <!-- Invoice Header -->
        <div class="invoice-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="brand">@storeName</div>
                    <div class="brand-subtitle">@storeSubtitle</div>
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-map-marker-alt me-1"></i> Empowering Traditional Indian Textiles
                        </small>
                    </div>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="invoice-details p-3">
                        <div class="mb-2">
                            <strong>INVOICE</strong><br>
                            <span class="h5 text-primary">@Model.InvoiceNumber</span>
                        </div>
                        <div>
                            <strong>Date:</strong><br>
                            @Model.SaleDate.ToString("dd MMM yyyy")<br>
                            <small class="text-muted">@Model.SaleDate.ToString("hh:mm tt")</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bill To & Sale Info -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <strong><i class="fas fa-user me-1"></i> Bill To</strong>
                    </div>
                    <div class="card-body">
                        @if (!string.IsNullOrWhiteSpace(Model.CustomerName))
                        {
                            <div class="h6">@Model.CustomerName</div>
                            @if (!string.IsNullOrWhiteSpace(Model.CustomerPhone))
                            {
                                <div><i class="fas fa-phone me-1"></i> @Model.CustomerPhone</div>
                            }
                        }
                        else
                        {
                            <div class="text-muted">Walk-in Customer</div>
                        }
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <strong><i class="fas fa-info-circle me-1"></i> Sale Information</strong>
                    </div>
                    <div class="card-body">
                        <div><strong>Payment Method:</strong> @Model.PaymentMethod</div>
                        @if (!string.IsNullOrWhiteSpace(Model.PaymentReference))
                        {
                            <div><strong>Reference:</strong> @Model.PaymentReference</div>
                        }
                        <div>
                            <strong>Status:</strong>
                            <span class="badge bg-success">@Model.Status</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Items Table -->
        <div class="table-responsive mb-4">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th style="width: 5%">#</th>
                        <th style="width: 40%">Item Description</th>
                        <th class="text-center" style="width: 8%">Qty</th>
                        <th class="text-end" style="width: 12%">Unit Price (₹)</th>
                        <th class="text-end" style="width: 10%">Disc (₹)</th>
                        <th class="text-center" style="width: 8%">GST%</th>
                        <th class="text-end" style="width: 12%">GST (₹)</th>
                        <th class="text-end" style="width: 15%">Total (₹)</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int itemNumber = 1;
                    }
                    @foreach (var item in Model.SaleItems)
                    {
                        <tr>
                            <td class="text-center">@itemNumber</td>
                            <td>
                                <strong>@item.ProductName</strong>
                            </td>
                            <td class="text-center">@item.Quantity</td>
                            <td class="text-end">@item.UnitPrice.ToString("N2")</td>
                            <td class="text-end">
                                @if (item.DiscountAmount > 0)
                                {
                                    @item.DiscountAmount.ToString("N2")
                                }
                                else
                                {
                                    <span class="text-muted">-</span>
                                }
                            </td>
                            <td class="text-center">@item.GSTRate%</td>
                            <td class="text-end">@item.GSTAmount.ToString("N2")</td>
                            <td class="text-end"><strong>@item.LineTotal.ToString("N2")</strong></td>
                        </tr>
                        itemNumber++;
                    }
                </tbody>
            </table>
        </div>

        <!-- Notes and Total -->
        <div class="row">
            <div class="col-md-6">
                @if (!string.IsNullOrWhiteSpace(Model.Notes))
                {
                    <div class="card">
                        <div class="card-header">
                            <strong><i class="fas fa-sticky-note me-1"></i> Notes</strong>
                        </div>
                        <div class="card-body">
                            @Model.Notes
                        </div>
                    </div>
                }
            </div>
            <div class="col-md-6">
                <div class="total-section">
                    <div class="p-3">
                        <table class="table table-borderless mb-0">
                            <tr>
                                <td><strong>Subtotal:</strong></td>
                                <td class="text-end">₹ @Model.SubTotal.ToString("N2")</td>
                            </tr>
                            <tr>
                                <td><strong>GST Amount:</strong></td>
                                <td class="text-end">₹ @Model.GSTAmount.ToString("N2")</td>
                            </tr>
                            @if (Model.DiscountAmount > 0)
                            {
                                <tr class="text-danger">
                                    <td><strong>Overall Discount:</strong></td>
                                    <td class="text-end">- ₹ @Model.DiscountAmount.ToString("N2")</td>
                                </tr>
                            }
                            <tr class="border-top border-2">
                                <th class="h4 text-primary">GRAND TOTAL:</th>
                                <th class="text-end h3 text-primary">₹ @Model.TotalAmount.ToString("N2")</th>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Quick Summary -->
                <div class="mt-3 p-2 bg-light rounded">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="fw-bold text-primary">@Model.SaleItems.Count()</div>
                            <small class="text-muted">Item Types</small>
                        </div>
                        <div class="col-6">
                            <div class="fw-bold text-success">@Model.TotalItems</div>
                            <small class="text-muted">Total Qty</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="row">
                <div class="col-md-4 text-md-start text-center">
                    <strong>Thank You!</strong><br>
                    <small>for supporting Indian Khadi</small>
                </div>
                <div class="col-md-4 text-center">
                    <i class="fas fa-heart text-danger"></i>
                    <strong>Made in India</strong>
                    <i class="fas fa-heart text-danger"></i>
                </div>
                <div class="col-md-4 text-md-end text-center">
                    <small class="text-muted">Printed: @DateTime.Now.ToString("dd MMM yyyy, hh:mm tt")</small>
                </div>
            </div>
        </div>
    </div>

    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto-print functionality (optional)
        // window.onload = function() { window.print(); }

        // Print button functionality
        function printInvoice() {
            window.print();
        }

        // ESC key to close
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                window.close();
            }
        });
    </script>
</body>
</html>